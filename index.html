<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Draggable Huly-Style Pin Demo</title>

  <!-- Tailwind CDN (JIT mode) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      margin: 0;
      font-family:
        system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu,
        "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji",
        "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      background-color: #ffffff;
      color: #000000;
    }
    /* Make text unselectable while dragging */
    .no-select {
      user-select: none;
    }
  </style>
</head>
<body class="p-8">

  <div class="relative max-w-screen-md mx-auto">
    <!-- STAR: Hero Section -->
    <h1 class="text-5xl font-bold">
      Knowledge at Your Fingertips
    </h1>

    <!-- The container for our heading + draggable pin -->
    <div class="relative mt-6 h-40 bg-gray-50 border rounded-lg">
      <!-- Sample “Knowledge at …” sub-heading, so the pin has something to overlap -->
      <h2 class="absolute top-8 left-8 text-4xl font-semibold">
        Knowledge at<br />
        Your Fingertips
      </h2>

      <!-- ===== Draggable Pin ===== -->
      <span
        id="draggable-pin"
        class="
          absolute
          z-50
          flex flex-col items-center
          hover:cursor-grab active:cursor-grabbing group
          right-[-38px] top-[-38px]
          text-blue
          lg:-right-10 lg:-top-10
          md:-right-7 md:-top-8
          sm:right-[-22px]
          transition-all
        "
        draggable="false"
        style="user-select: none; touch-action: none; transform: translate(0, 0);"
      >
        <!-- Circular avatar -->
        <img
          id="pin-img"
          src="https://huly.io/_next/static/media/blue-pin-image.bb230dcd.jpg"
          alt="Avatar Pin"
          width="66"
          height="66"
          class="
            pointer-events-none
            z-10
            max-w-none
            rounded-full
            border-2 border-blue
            shadow-[0px_6px_25px_0px_#00000080]
            transition-all duration-200
            group-active:translate-y-[-15px]
            group-active:scale-[1.05]
            group-active:shadow-[0px_14px_30px_0px_#00000080]
            md:max-w-[45px]
            sm:max-w-[36px]
          "
          style="color: transparent;"
          loading="lazy"
        />

        <!-- Stick beneath avatar -->
        <span
          class="
            flex flex-col items-center
            transition-transform duration-200
            group-active:-translate-y-[25px]
          "
        >
          <span class="h-[46px] w-0.5 bg-blue md:h-[34px] md:w-px sm:h-[26px]"></span>
          <span class="-mt-px h-2.5 w-2.5 rounded-full bg-blue md:h-[7px] md:w-[7px]"></span>
        </span>
      </span>
      <!-- ===== End Draggable Pin ===== -->
    </div>
    <!-- END: Hero Section -->
  </div>

  <!-- ===== JavaScript for Dragging ===== -->
  <script>
    (function() {
      const pin = document.getElementById("draggable-pin");
      let isDragging = false;
      let offsetX = 0;
      let offsetY = 0;

      // Helper: get current translateX and translateY of the pin (in px)
      function getCurrentTranslate(elem) {
        const style = window.getComputedStyle(elem);
        const transform = style.transform || style.webkitTransform || style.mozTransform;

        // Default: no transform → (0, 0)
        if (transform === "none" || !transform) {
          return { x: 0, y: 0 };
        }

        // Transform looks like "matrix(a, b, c, d, tx, ty)" or "matrix3d(...)"
        const values = transform.match(/matrix.*(.+)/)[1].split(",").map(v => v.trim());
        // matrix(a, b, c, d, tx, ty)
        if (values.length === 6) {
          return {
            x: parseFloat(values[4]),
            y: parseFloat(values[5])
          };
        }
        // matrix3d(...) → the 13th and 14th items are tx, ty
        if (values.length === 16) {
          return {
            x: parseFloat(values[12]),
            y: parseFloat(values[13])
          };
        }
        return { x: 0, y: 0 };
      }

      // Mousedown on pin: start dragging
      pin.addEventListener("mousedown", function(e) {
        e.preventDefault();
        isDragging = true;

        // Calculate where inside the pin the user clicked
        const pinRect = pin.getBoundingClientRect();
        offsetX = e.clientX - pinRect.left;
        offsetY = e.clientY - pinRect.top;

        // Add a class to disable text selection
        document.body.classList.add("no-select");

        // Add the CSS class that shows the “pressed” state (lift + scale)
        pin.classList.add("active");
      });

      // Mousemove: if dragging, update pin position
      document.addEventListener("mousemove", function(e) {
        if (!isDragging) return;

        // Compute new top-left so that the cursor stays at (offsetX, offsetY) inside the pin
        const container = pin.parentElement; // The relative‐positioned parent
        const containerRect = container.getBoundingClientRect();

        let newX = e.clientX - containerRect.left - offsetX;
        let newY = e.clientY - containerRect.top - offsetY;

        // Set transform style directly
        pin.style.transform = `translate(${newX}px, ${newY}px)`;
      });

      // Mouseup: stop dragging
      document.addEventListener("mouseup", function() {
        if (!isDragging) return;
        isDragging = false;

        // Remove “pressed” state
        pin.classList.remove("active");

        // Re‐enable text selection
        document.body.classList.remove("no-select");
      });

      // Also stop dragging if the user leaves the window
      document.addEventListener("mouseleave", function() {
        if (!isDragging) return;
        isDragging = false;
        pin.classList.remove("active");
        document.body.classList.remove("no-select");
      });
    })();
  </script>
  <!-- ===== End JavaScript ===== -->

</body>
</html>
